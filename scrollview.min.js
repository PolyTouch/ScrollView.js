/*!
 * Scrollview.js 1.2.1
 * http://github.com/PolyTouch/ScrollView.js
 *
 *
 * Copyright 2014 Adobe Systems Incorporated
 * Released under the Apache License v2
 *
 * Author: Damien Antipa
 * Date: 2014-07-03T10:12:33.271Z
 */
!function(a){function b(a,b,c){var d=new CustomEvent(b,{detail:c||{},bubbles:!0,cancelable:!0});a.dispatchEvent(d)}function c(a,b){var c=b||{};this.view="string"==typeof a?document.querySelector(a):a,this.scroller=this.view.children[0],this.options={start:c.start||[0,0],scrollX:void 0!==c.scrollX?c.scrollX:!1,scrollY:void 0!==c.scrollY?c.scrollY:!0,inertia:void 0!==c.inertia?c.inertia:!0,inertiaTime:c.inertiaTime||1.5*Math.min(window.innerHeight,window.innerWidth),inertiaDeceleration:c.inertiaDeceleration||6e-4,bounce:void 0!==c.bounce?c.bounce:!0,bounceTime:c.bounceTime||600,bounceDistance:c.bounceDistance||Math.floor(Math.max(window.innerHeight,window.innerWidth)/8)},this._enabled=!0,this._lastPointer=!1,this._curPointer=!1,this._handleStart=this._handleStart.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this),this._handleInertiaEnd=this._handleInertiaEnd.bind(this),this._handleBounceTransitionEnd=this._handleBounceTransitionEnd.bind(this),this.view.addEventListener("pointerdown",this._handleStart,!1),this.scrollTo(this.options.start[0],this.options.start[1])}var d={quadratic:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",circular:"cubic-bezier(0.1, 0.57, 0.1, 1)"},e=.01,f=1.5,g=1500,h={distance:function(a,b){return Math.floor(b-a)},velocity:function(a,b){return Math.abs(a)/b},direction:function(a){return 0>a?-1:a>0?1:0},inertia:function(a,b,c,d,g,i,j){var k,l;return Math.abs(c)<e?(j=0,l=a):l=c*(1-Math.pow(i,j+1))/(1-i),k=a+l*b,(d>k||k>g)&&(k=d>k?d:k>g?g:k,l=h.distance(a,k),j=l/Math.min(c,f)),{destination:Math.floor(k),duration:parseFloat(j)}}};c.prototype={version:"1.2.1",x:0,y:0,destroy:function(){this.cancel(),this.view.removeEventListener("pointerdown",this._handleStart,!1)},enable:function(a){this._enabled=a===!1?a:!0},cancel:function(a){a&&this._curPointer&&this._curPointer!==a||(this._curPointer=!1,this._forceTransitionEnd(),document.removeEventListener("pointerup",this._handleEnd,!1),document.removeEventListener("pointercancel",this._handleEnd,!1),document.removeEventListener("pointermove",this._handleMove,!1))},scrollTo:function(a,b,c,e){var f=e||d.circular;this.scroller.style.transitionTimingFunction=this.scroller.style.webkitTransitionTimingFunction=f,this.scroller.style.transitionDuration=this.scroller.style.webkitTransitionDuration=(c||0)+"ms",this._transform(a,b)},_handleStart:function(a){if(this._enabled&&!this._curPointer&&("mouse"!==a.pointerType||1===a.buttons)){var b=(new Date).getTime();this._curPointer=a.pointerId,this._hasMoved=!1,this._getBoundaries(),this._forceTransitionEnd(!0),this._lastPointer=a.pointerId,this._lastPoint={timestamp:b,x:a.pageX,y:a.pageY},this._lastKeyFrame={timestamp:b,x:this.x,y:this.y},document.addEventListener("pointerup",this._handleEnd,!1),document.addEventListener("pointercancel",this._handleEnd,!1),document.addEventListener("pointermove",this._handleMove,!1)}},_handleMove:function(a){if(this._enabled&&this._curPointer===a.pointerId){var c,d,e=this.options.scrollX?h.distance(this._lastPoint.x,a.pageX):0,f=this.options.scrollY?h.distance(this._lastPoint.y,a.pageY):0,g=(new Date).getTime();if(c=this.x+e,d=this.y+f,c=c>0?this.options.bounce?this.x+e/3:0:c,d=d>0?this.options.bounce?this.y+f/3:0:d,c=c<this._boundaries[0]?this.options.bounce?this.x+e/3:this._boundaries[0]:c,d=d<this._boundaries[1]?this.options.bounce?this.y+f/3:this._boundaries[1]:d,!this._hasMoved){if(Math.abs(e)<10&&Math.abs(f)<10)return;this._hasMoved=!0,b(this.view,"scrollstart",{pointerId:this._curPointer,x:this.x,y:this.y})}this._lastPoint={timestamp:g,x:a.pageX,y:a.pageY},g-this._lastKeyFrame.timestamp>150&&(this._lastKeyFrame={timestamp:g,x:c,y:d}),this.scrollTo(c,d),b(this.view,"scroll",{pointerId:this._curPointer,x:c,y:d})}},_handleEnd:function(a){if(this._enabled&&this._curPointer===a.pointerId){var c,d,e,f,i,j,k=(new Date).getTime()-this._lastKeyFrame.timestamp,l=this.options.scrollX?h.distance(this._lastPoint.x,a.pageX):0,m=this.options.scrollY?h.distance(this._lastPoint.y,a.pageY):0,n=this.x+l,o=this.y+m;this._curPointer=!1,document.removeEventListener("pointerup",this._handleEnd,!1),document.removeEventListener("pointercancel",this._handleEnd,!1),document.removeEventListener("pointermove",this._handleMove,!1),this._hasMoved&&(this.scrollTo(n,o),b(this.view,"scroll",{pointerId:this._curPointer,x:this.x,y:this.y}),this.options.inertia&&150>k&&(c=[h.distance(this._lastKeyFrame.x,this.x),h.distance(this._lastKeyFrame.y,this.y)],d=[h.direction(c[0]),h.direction(c[1])],e=[h.velocity(c[0],k),h.velocity(c[1],k)],f=[this.options.bounce?this._boundaries[0]-this.options.bounceDistance:this._boundaries[0],this.options.bounce?this._boundaries[1]-this.options.bounceDistance:this._boundaries[1],this.options.bounce?0+this.options.bounceDistance:0,this.options.bounce?0+this.options.bounceDistance:0],i=[h.inertia(this.x,d[0],e[0],f[0],f[2],1-this.options.inertiaDeceleration,this.options.inertiaTime>g?g:this.options.inertiaTime),h.inertia(this.y,d[1],e[1],f[1],f[3],1-this.options.inertiaDeceleration,this.options.inertiaTime>g?g:this.options.inertiaTime)],n=i[0].destination,o=i[1].destination,j=Math.max(i[0].duration,i[1].duration)),this._observePosition(),this.x<=0&&this.x>=this._boundaries[0]&&this.y<=0&&this.y>=this._boundaries[1]&&(n!==this.x||o!==this.y)?(this.scroller.addEventListener("transitionEnd",this._handleInertiaEnd,!1),this.scroller.addEventListener("webkitTransitionEnd",this._handleInertiaEnd,!1),this.scrollTo(n,o,j)):this._startBounceTransition())}},_handleInertiaEnd:function(a){a.target===this.scroller&&(this.scroller.removeEventListener("transitionEnd",this._handleInertiaEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleInertiaEnd,!1),this._startBounceTransition())},_startBounceTransition:function(){var a=this.x>0?0:this.x<this._boundaries[0]?this._boundaries[0]:this.x,c=this.y>0?0:this.y<this._boundaries[1]?this._boundaries[1]:this.y;!this.options.bounce||a===this.x&&c===this.y?(b(this.view,"scrollend",{pointerId:this._lastPointer}),this._observePosition(!1)):(this.scroller.addEventListener("transitionEnd",this._handleBounceTransitionEnd,!1),this.scroller.addEventListener("webkitTransitionEnd",this._handleBounceTransitionEnd,!1),this.scrollTo(a,c,this.options.bounceTime))},_handleBounceTransitionEnd:function(a){a.target===this.scroller&&(this.scroller.removeEventListener("transitionEnd",this._handleBounceTransitionEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleBounceTransitionEnd,!1),b(this.view,"scrollend",{pointerId:this._lastPointer}),this._observePosition(!1))},_forceTransitionEnd:function(a){this.scroller.removeEventListener("transitionEnd",this._handleInertiaEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleInertiaEnd,!1),this.scroller.removeEventListener("transitionEnd",this._handleBounceTransitionEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleBounceTransitionEnd,!1),this._transform.apply(this,this._getTransformPosition()||[0,0]),this._observePosition(!1),a||(b(this.view,"scrollcancel",{pointerId:this._lastPointer}),b(this.view,"scrollend",{pointerId:this._lastPointer}))},_transform:function(a,b){this.x=Math.floor(a),this.y=Math.floor(b);var c="translate("+this.x+"px,"+this.y+"px)",d=" translateZ(0)";this.scroller.style.transform=this.scroller.style.webkitTransform=c+d},_getTransformPosition:function(){var a,b=window.getComputedStyle(this.scroller,null);return a=(b.transform||b.webkitTransform).match(/matrix\( *([^, ]*) *, *([^, ]*) *, *([^, ]*) *, *([^, ]*) *, *([^, ]*) *, *([^, ]*) *\)/),a?[Math.floor(a[5]),Math.floor(a[6])]:null},_getBoundaries:function(){this._boundaries=[-this.scroller.scrollWidth+this.view.clientWidth,-this.scroller.scrollHeight+this.view.clientHeight]},_observePosition:function(a){var c,d=this._getTransformPosition();a===!1?(window.cancelAnimationFrame||window.webkitCancelAnimationFrame)(this._observeId):(c=function(){var a=this._getTransformPosition();(d[0]!==a[0]||d[1]!==a[1])&&b(this.view,"scroll",{pointerId:this._lastPointer,x:a[0],y:a[1]}),d=a,this._observeId=(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(c.bind(this))},this._observeId=(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(c.bind(this)))}},a.ScrollView=c}(window.polyTouch||window);
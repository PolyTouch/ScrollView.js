/*!
 * Scrollview.js 1.1.2
 * http://github.com/PolyTouch/ScrollView.js
 *
 *
 * Copyright 2014 Adobe Systems Incorporated
 * Released under the Apache License v2
 *
 * Author: Damien Antipa
 * Date: 2014-06-24T13:39:12.006Z
 */
!function(a){function b(a,b,c){var d=new CustomEvent(b,{detail:c||{},bubbles:!0,cancelable:!0});a.dispatchEvent(d)}function c(a,b){var c=b||{};this.view="string"==typeof a?document.querySelector(a):a,this.scroller=this.view.children[0],this.options={start:c.start||[0,0],scrollX:void 0!==c.scrollX?c.scrollX:!1,scrollY:void 0!==c.scrollY?c.scrollY:!0,inertia:void 0!==c.inertia?c.inertia:!0,inertiaDeceleration:c.inertiaDeceleration||6e-4,bounce:void 0!==c.bounce?c.bounce:!0,bounceTime:c.bounceTime||600},this._enabled=!0,this._lastPointer=!1,this._curPointer=!1,this._handleStart=this._handleStart.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this),this._handleInertiaEnd=this._handleInertiaEnd.bind(this),this._handleBounceTransitionEnd=this._handleBounceTransitionEnd.bind(this),this.view.addEventListener("pointerdown",this._handleStart,!1),this.scrollTo(this.options.start[0],this.options.start[1])}var d={quadratic:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",circular:"cubic-bezier(0.1, 0.57, 0.1, 1)"},e={distance:function(a,b){return Math.round(b-a)},velocity:function(a,b){return Math.abs(a)/b},direction:function(a){return 0>a?-1:a>0?1:0},inertia:function(a,b,c,d,e,f){var g,h;return h=c/f,g=a+c*h*h*.5*f*b,(d>g||g>e)&&(g=d>g?d:g>e?e:g,h=Math.sqrt(Math.abs((g-a)/(.5*c*f*b)))),{destination:Math.round(g),duration:parseFloat(h)}}};c.prototype={version:"1.1.2",x:0,y:0,destroy:function(){this.cancel(),this.view.removeEventListener("pointerdown",this._handleStart,!1)},enable:function(a){this._enabled=a===!1?a:!0},cancel:function(a){a&&this._curPointer&&this._curPointer!==a||(this._curPointer=!1,this._forceTransitionEnd(),document.removeEventListener("pointerup",this._handleEnd,!1),document.removeEventListener("pointercancel",this._handleEnd,!1),document.removeEventListener("pointermove",this._handleMove,!1))},scrollTo:function(a,b,c,e){var f=e||d.circular;this.scroller.style.transitionTimingFunction=this.scroller.style.webkitTransitionTimingFunction=f,this.scroller.style.transitionDuration=this.scroller.style.webkitTransitionDuration=(c||0)+"ms",this._transform(a,b)},_handleStart:function(a){if(this._enabled&&!this._curPointer&&("mouse"!==a.pointerType||1===a.buttons)){var b=(new Date).getTime();this._curPointer=a.pointerId,this._hasMoved=!1,this._getBoundaries(),this._forceTransitionEnd(!0),this._lastPointer=a.pointerId,this._lastPoint={timestamp:b,x:a.pageX,y:a.pageY},this._lastKeyFrame={timestamp:b,x:this.x,y:this.y},document.addEventListener("pointerup",this._handleEnd,!1),document.addEventListener("pointercancel",this._handleEnd,!1),document.addEventListener("pointermove",this._handleMove,!1)}},_handleMove:function(a){if(this._enabled&&this._curPointer===a.pointerId){var c,d,f=this.options.scrollX?e.distance(this._lastPoint.x,a.pageX):0,g=this.options.scrollY?e.distance(this._lastPoint.y,a.pageY):0,h=(new Date).getTime();this._lastPoint={timestamp:h,x:a.pageX,y:a.pageY},c=this.x+f,d=this.y+g,c=c>0?this.options.bounce?this.x+f/3:0:c,d=d>0?this.options.bounce?this.y+g/3:0:d,c=c<this._boundaries[0]?this.options.bounce?this.x+f/3:this._boundaries[0]:c,d=d<this._boundaries[1]?this.options.bounce?this.y+g/3:this._boundaries[1]:d,this._hasMoved||(this._hasMoved=!0,b(this.view,"scrollstart",{pointerId:this._curPointer,x:this.x,y:this.y})),h-this._lastKeyFrame.timestamp>300&&(this._lastKeyFrame={timestamp:h,x:c,y:d}),this.scrollTo(c,d),b(this.view,"scroll",{pointerId:this._curPointer,x:c,y:d})}},_handleEnd:function(a){if(this._enabled&&this._curPointer===a.pointerId){var c,f,g,h,i,j,k=(new Date).getTime()-this._lastKeyFrame.timestamp,l=this.options.scrollX?e.distance(this._lastPoint.x,a.pageX):0,m=this.options.scrollY?e.distance(this._lastPoint.y,a.pageY):0,n=this.x+l,o=this.y+m;this._curPointer=!1,document.removeEventListener("pointerup",this._handleEnd,!1),document.removeEventListener("pointercancel",this._handleEnd,!1),document.removeEventListener("pointermove",this._handleMove,!1),this._hasMoved&&(this.scrollTo(n,o),b(this.view,"scroll",{pointerId:this._curPointer,x:this.x,y:this.y}),this.options.inertia&&300>k&&(c=[e.distance(this._lastKeyFrame.x,this.x),e.distance(this._lastKeyFrame.y,this.y)],f=[e.direction(c[0]),e.direction(c[1])],g=[e.velocity(c[0],k),e.velocity(c[1],k)],h=[this.options.bounce?this._boundaries[0]-this.view.clientWidth/2:this._boundaries[0],this.options.bounce?this._boundaries[1]-this.view.clientHeight/2:this._boundaries[1],this.options.bounce?0+this.view.clientWidth/2:0,this.options.bounce?0+this.view.clientHeight/2:0],i=[e.inertia(this.x,f[0],g[0],h[0],h[2],this.options.inertiaDeceleration),e.inertia(this.y,f[1],g[1],h[1],h[3],this.options.inertiaDeceleration)],n=i[0].destination,o=i[1].destination,j=Math.max(i[0].duration,i[1].duration)),this._observePosition(),this.x<=0&&this.x>=this._boundaries[0]&&this.y<=0&&this.y>=this._boundaries[1]&&(n!==this.x||o!==this.y)?(this.scroller.addEventListener("transitionEnd",this._handleInertiaEnd,!1),this.scroller.addEventListener("webkitTransitionEnd",this._handleInertiaEnd,!1),this.scrollTo(n,o,j,n>0||n<this._boundaries[0]||o>0||o<this._boundaries[1]?d.quadratic:null)):this._startBounceTransition())}},_handleInertiaEnd:function(a){a.target===this.scroller&&(this.scroller.removeEventListener("transitionEnd",this._handleInertiaEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleInertiaEnd,!1),this._startBounceTransition())},_startBounceTransition:function(){var a=this.x>0?0:this.x<this._boundaries[0]?this._boundaries[0]:this.x,c=this.y>0?0:this.y<this._boundaries[1]?this._boundaries[1]:this.y;!this.options.bounce||a===this.x&&c===this.y?(b(this.view,"scrollend",{pointerId:this._lastPointer}),this._observePosition(!1)):(this.scroller.addEventListener("transitionEnd",this._handleBounceTransitionEnd,!1),this.scroller.addEventListener("webkitTransitionEnd",this._handleBounceTransitionEnd,!1),this.scrollTo(a,c,this.options.bounceTime))},_handleBounceTransitionEnd:function(a){a.target===this.scroller&&(this.scroller.removeEventListener("transitionEnd",this._handleBounceTransitionEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleBounceTransitionEnd,!1),b(this.view,"scrollend",{pointerId:this._lastPointer}),this._observePosition(!1))},_forceTransitionEnd:function(a){this.scroller.removeEventListener("transitionEnd",this._handleInertiaEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleInertiaEnd,!1),this.scroller.removeEventListener("transitionEnd",this._handleBounceTransitionEnd,!1),this.scroller.removeEventListener("webkitTransitionEnd",this._handleBounceTransitionEnd,!1),this._transform.apply(this,this._getTransformPosition()||[0,0]),this._observePosition(!1),a||(b(this.view,"scrollcancel",{pointerId:this._lastPointer}),b(this.view,"scrollend",{pointerId:this._lastPointer}))},_transform:function(a,b){this.x=Math.round(a),this.y=Math.round(b);var c="translate("+this.x+"px,"+this.y+"px)",d=" translateZ(0)";this.scroller.style.transform=this.scroller.style.webkitTransform=c+d},_getTransformPosition:function(){var a,b=window.getComputedStyle(this.scroller,null);return a=(b.transform||b.webkitTransform).match(/matrix\( *([^, ]*) *, *([^, ]*) *, *([^, ]*) *, *([^, ]*) *, *([^, ]*) *, *([^, ]*) *\)/),a?[Math.round(a[5]),Math.round(a[6])]:null},_getBoundaries:function(){this._boundaries=[-this.view.scrollWidth+this.view.clientWidth,-this.view.scrollHeight+this.view.clientHeight]},_observePosition:function(a){var c,d=this._getTransformPosition();a===!1?(window.cancelAnimationFrame||window.webkitCancelAnimationFrame)(this._observeId):(c=function(){var a=this._getTransformPosition();(d[0]!==a[0]||d[1]!==a[1])&&b(this.view,"scroll",{pointerId:this._lastPointer,x:a[0],y:a[1]}),d=a,this._observeId=(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(c.bind(this))},this._observeId=(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(c.bind(this)))}},a.ScrollView=c}(window.polyTouch||window);